# AI Agent Documentation   ///// 🤖

## מה זה ה-AI Agent?

ה-AI Agent הוא מרכיב מתקדם בפרוייקט שמשתמש ב-OpenAI GPT-4 כדי להבין בקשות תיאום שיעורים בשפה טבעית ולהמיר אותן לפעולות מובנות.

## איפה הוא נמצא?

📁 **קובץ ראשי:** `src/ai/scheduler.js`  
📁 **שימוש ב:** `src/bot/handlers/messageHandler.js`

## מה הוא עושה?

### 1. 🧠 הבנת שפה טבעית
- מקבל הודעות כמו "אני רוצה שיעור מתמטיקה ביום שישי בשעה 3"
- מבין את הכוונה (לתאם שיעור, לבטל, לבדוק זמינות)
- מחלץ פרטים: תאריכים, שעות, נושא השיעור

### 2. 📊 פלט מובנה
המערכת מחזירה JSON מובנה עם:
```json
{
  "intent": "book_lesson",
  "confidence": 0.9,
  "datetime_preferences": [{
    "date": "2024-01-15",
    "time": "15:00",
    "flexibility": "exact"
  }],
  "lesson_details": {
    "subject": "math",
    "topic": "algebra"
  }
}
```

### 3. 🎯 כוונות שהוא מזהה
- `book_lesson` - תיאום שיעור חדש
- `reschedule_lesson` - שינוי שיעור קיים
- `cancel_lesson` - ביטול שיעור
- `check_availability` - בדיקת זמינות
- `join_waitlist` - הצטרפות לרשימת המתנה
- `other` - הודעות שלא קשורות לתיאום

### 4. 🛠️ טכנולוגיות בשימוש
- **OpenAI GPT-4 Turbo** - המוח המרכזי
- **LangChain** - מסגרת עבודה עם LLM
- **Chrono-node** - זיהוי תאריכים ושעות
- **Zod** - ולידציה של הפלט

## איך זה עובד?

### 1. קבלת הודעה
```javascript
const result = await aiScheduler.processSchedulingRequest(
  "אני רוצה שיעור מחר בשעה 3",
  studentProfile
);
```

### 2. עיבוד ב-AI
- שולח את ההודעה ל-GPT-4 עם הקשר מלא
- מקבל תגובה JSON מובנה
- מאמת את התגובה מול הסכמה

### 3. פעולה במערכת
- בודק זמינות
- מציע זמנים חלופיים
- מתאם את השיעור

## דוגמאות לשימוש

### בקשה פשוטה:
**קלט:** "רוצה שיעור מתמטיקה מחר"  
**פלט:** מזהה כוונה לתיאום + מציע זמנים זמינים

### בקשה מורכבת:
**קלט:** "צריך לשנות את השיעור שלי ביום שלישי לזמן אחר השבוע"  
**פלט:** מזהה כוונה לשינוי + מוצא את השיעור + מציע חלופות

### בקשה לא ברורה:
**קלט:** "מתי אני יכול?"  
**פלט:** מבקש הבהרה + מציג זמנים זמינים

## הגדרות נוכחיות

```javascript
// src/config/settings.js
ai: {
  model: 'gpt-4-turbo-preview',
  maxTokens: 500,
  temperature: 0.7,
  timeout: 10000
}
```

## רמת ביטחון

המערכת מחזירה רמת ביטחון (0-1) לכל זיהוי:
- **0.9-1.0** - זיהוי מדויק מאוד
- **0.7-0.8** - זיהוי טוב
- **0.5-0.6** - זיהוי חלקי, צריך הבהרה
- **0-0.4** - לא הבין, fallback למענה כללי

## איך להוסיף יכולות חדשות?

1. **הוסף כוונה חדשה** ב-`SchedulingRequestSchema`
2. **עדכן את ה-prompt** ב-`setupPromptTemplate()`
3. **הוסף טיפול** ב-`messageHandler.js`

## בדיקת ביצועים

המערכת לוגגת את כל הפעילות:
```
AI processing_request: "רוצה שיעור מחר"
AI request_processed: {"intent": "book_lesson", "confidence": 0.9}
```

---

**💡 הערה:** ה-AI Agent הוא המוח של הבוט - הוא מה שהופך אותו מבוט פקודות רגיל לעוזר אישי חכם שמבין שפה טבעית! 